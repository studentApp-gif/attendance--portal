<!DOCTYPE html><html><head><meta charset="UTF-8"><title> SVCE Student Attendance Portal</title>
<style>body{font-family:Arial;background:#f2f2f2;margin:0}.container{max-width:700px;margin:20px auto;background:#fff;padding:20px;border-radius:8px}
label{font-weight:bold;margin-top:10px;display:block}select,input,button{width:100%;padding:10px;margin:6px 0 12px}
button{background:#337ab7;color:white;border:none;cursor:pointer}button:hover{background:#23527c}
.approvedStudent{background:#e6ffe6}</style></head>
<body>
<div class="container">
<h2>Attendance Portal</h2>
<label>Select Year / Branch</label><select id="yearSelect"></select>
<label>Session</label><select id="session"><option value="Morning">Morning</option><option value="Afternoon">Afternoon</option></select>
<button onclick="loadAttendance()">Load Students</button>
<div id="attendanceForm"></div>
<button id="saveBtn" onclick="submitAttendance()" disabled>Save Attendance</button>
<p id="msg"></p>
</div>
<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbwnwn20CSLQrT55Kfyw_CoBM2PipoNMzbEPpVDocuMBF1zn81LLuEYNxuS0-X95XU5t/exec";const dept=new URLSearchParams(window.location.search).get("dept") || "CSM";
let approvedRolls=[];
/* ================= HS SMART DROPDOWN ================= */
function loadDropdown(){
const dropdown=document.getElementById("yearSelect");
if(dept==="HS"){
dropdown.innerHTML=`<option value="HS-CSM-1">1st Year CSM</option><option value="HS-CSE-1">1st Year CSE</option><option value="HS-ECE-1">1st Year ECE</option>`;
}else{
dropdown.innerHTML=`<option value="1">1st Year</option><option value="2">2nd Year</option><option value="3">3rd Year</option><option value="4">4th Year</option>`;
}
}
loadDropdown();
/* ================= LOAD STUDENTS ================= */
async function loadAttendance(){
msg("Loading students...");document.getElementById("saveBtn").disabled=true;
const selected=document.getElementById("yearSelect").value;
let year=selected;let branch=null;
if(dept==="HS"){const parts=selected.split("-");branch=parts[1];year=parts[2];}
try{
const res=await fetch(`${SCRIPT_URL}?action=getStudents&dept=${dept}&year=${year}`);const json=await res.json();
if(!json.success){msg("No students found");return;}
let students=json.students;
/* ===== HS BRANCH FILTER ===== */
if(dept==="HS" && branch){
students=students.filter(s=>{
const roll=s.rollno;
if(branch==="CSM") return roll.includes("33");if(branch==="CSE") return roll.includes("05");if(branch==="ECE") return roll.includes("04");
return true;
});
}
let html=`<label>Boys Present</label><input type="number" id="boysPresent" value="0">
<label>Girls Present</label><input type="number" id="girlsPresent" value="0">
<div id="studentsList">`;
students.forEach(s=>{
html+=`<label><input type="checkbox" value="${s.rollno}">${s.rollno}</label>`;
});
html+="</div>";
document.getElementById("attendanceForm").innerHTML=html;document.getElementById("saveBtn").disabled=false;
msg("");
}catch(e){msg("Server Error");}
}
/* ================= SAVE ATTENDANCE ================= */
async function submitAttendance(){
const selected=document.getElementById("yearSelect").value;
let year=selected;
if(dept==="HS"){year=selected.split("-")[2];}
const session=document.getElementById("session").value;const date=new Date().toISOString().split("T")[0];
const boys=document.getElementById("boysPresent").value;const girls=document.getElementById("girlsPresent").value;
const url=`${SCRIPT_URL}?action=saveAttendancePresent&dept=${dept}&year=${year}&date=${date}&session=${session}&boysPresent=${boys}&girlsPresent=${girls}`;
const res=await fetch(url);const json=await res.json();
msg(json.message);document.getElementById("saveBtn").disabled=true;
}
/* ================= UTIL ================= */
function msg(t){document.getElementById("msg").innerText=t;}
</script>
</body></html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title> SVCE Attendance Portal</title>
<style>
    body {
        font-family: sans-serif;
        margin: 0;
        padding: 0;
        background: #f4f4f4;
    }
    .container {
        width: 90%;
        max-width: 600px;
        margin: 20px auto;
        background: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,.2);
    }
    h2 {
        text-align: center;
        color: #004d80;
        margin-bottom: 10px;
    }
    .logo {
        display: block;
        margin: 20px auto;
        max-width: 140px;
        height: auto;
    }
    label {
        display: block;
        margin: 10px 0 5px;
    }
    input, select, button {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        border: 1px solid #ccc;
        box-sizing: border-box;
    }
    button {
        background: #337ab7;
        color: #fff;
        border: none;
        cursor: pointer;
    }
    button:hover {
        background: #286090;
    }
    /* ✅ Roll number left – Checkbox right */
    #studentsList label {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 6px 0;
        padding: 6px 10px;
        background: #f9f9f9;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    #studentsList input[type="checkbox"] {
        width: 18px;
        height: 18px;
        margin: 0;
    }
    #msg {
        text-align: center;
        font-weight: 500;
        margin-top: 10px;
        color: #004d80;
    }
</style>
</head>
<body>

<!-- ✅ College Logo -->
<img src="1615998820020.jpg" alt="College Logo" class="logo">

<div class="container">
    <h2>Attendance Portal</h2>

    <label for="date">Select Date:</label>
    <input type="date" id="date">

    <label for="year">Select Year:</label>
    <select id="year">
        <option value="2">2nd Year</option>
        <option value="3">3rd Year</option>
        <option value="4">4th Year</option>
    </select>

    <button onclick="loadStudents()">Load Students</button>

    <div id="studentsList"></div>

    <button onclick="saveAttendance()">Save Attendance</button>
    <p id="msg"></p>
</div>

<script>
    // ✅ Replace with your Apps Script WebApp URL
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz3a_w2-SWIplHcYxyE3mkQFBOsnvilgxwxunnPH3NSRCMq2Q5-x2-udND_6uLk2p4l/exec";

    const params = new URLSearchParams(window.location.search);
    const dept = params.get("dept") || "";

    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('date').value = new Date().toISOString().split('T')[0];
    });

    async function loadStudents() {
        const yr = document.getElementById('year').value;
        const studentsListDiv = document.getElementById('studentsList');
        const msg = document.getElementById('msg');
        msg.textContent = 'Loading...';
        try {
            const res = await fetch(`${WEBAPP_URL}?action=getStudents&dept=${dept}&year=${yr}`);
            const data = await res.json();
            if (!data.success) {
                msg.textContent = data.message;
                return;
            }
            studentsListDiv.innerHTML = data.students
                .map(s =>
                    `<label>
                        <span>${s.rollno}</span>
                        <input type="checkbox" value="${s.rollno}">
                    </label>`
                ).join("");
            msg.textContent = '';
        } catch (err) {
            msg.textContent = 'Error: ' + err;
        }
    }

    async function saveAttendance() {
        const date = document.getElementById('date').value;
        const yr = document.getElementById('year').value;
        const present = [...document.querySelectorAll('#studentsList input:checked')]
            .map(c => c.value).join(',');
        if (!present) {
            document.getElementById('msg').textContent = "No student selected!";
            return;
        }
        const msg = document.getElementById('msg');
        msg.textContent = 'Saving...';
        try {
            const res = await fetch(`${WEBAPP_URL}?action=saveAttendance&dept=${dept}&year=${yr}&date=${date}&present=${present}`);
            const j = await res.json();
            msg.textContent = j.message || "Attendance saved successfully!";
        } catch (err) {
            msg.textContent = 'Error: ' + err;
        }
    }
</script>
</body>
</html>
